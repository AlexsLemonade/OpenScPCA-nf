// profile for instances with mountpoint S3 storage

workDir = '/mnt/work'
docker.enabled = true
wave.enabled = true
fusion.enabled = false

params.pullthrough_registry = '992382809252.dkr.ecr.us-east-2.amazonaws.com'

aws {
  batch {
    volumes = ['/data/tmp:/tmp:rw']
    maxTransferAttempts = 3
    maxSpotAttempts = 2
  }
  region = 'us-east-2'
}

process {
  executor = 'awsbatch'
  resourceLimits = [cpus: 64, memory: 512.GB]
  queue = 'openscpca-nf-batch-default-mountpoint-queue'
  scratch = false
  // switch to the priority queue for known long running tasks if failing
  withLabel: long_running {
    queue = { task.attempt < 2 ? 'openscpca-nf-batch-default-mountpoint-queue' : 'openscpca-nf-batch-priority-mountpoint-queue' }
  }
}
